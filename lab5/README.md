## üß™ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ5
**üìö –ü—Ä–µ–¥–º–µ—Ç: –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è** <br>
**üë®‚Äçüíª –í—ã–ø–æ–ª–Ω–∏–ª: –ö–æ—Ä–æ–ª–µ–≤ –ò–≤–∞–Ω, –ú80-114–°–í**

### üìã –ó–∞–¥–∞–Ω–∏–µ:
1.  –î–ª—è –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–µ PotgreSQL —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —à–∞–±–ª–æ–Ω
—Å–∫–≤–æ–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏ —Å–∫–≤–æ–∑–Ω–∞—è –∑–∞–ø–∏—Å—å (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–ö–ª–∏–µ–Ω—Ç ‚Ä¶);
2.  –í –∫–∞—á–µ—Å—Ç–≤–µ –∫–µ—à–∞ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis
3.  –ó–∞–º–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏ –±–µ–∑ –∫–µ—à–∞ —Å
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç—ã wrk https://github.com/wg/wrk –∏–∑–º–µ–Ω—è—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
–ø–æ—Ç–æ–∫–æ–≤ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã (1, 5, 10)
4. –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤ Structurizr DSL
5.  –í–∞—à–∏ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ docker-compose –∫–æ–º–∞–Ω–¥–æ–π dockercompose up (—Å–æ–∑–¥–∞–π—Ç–µ Docker —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ C++
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Poco https://docs.pocoproject.org/current/
- –ü—Ä–∏–º–µ—Ä –ø–æ —Ä–∞–±–æ—Ç–µ —Å Poco Web Servers –∏ Redis
https://github.com/DVDemon/arch_lecture_examples/tree/main/hl_mai_lab_05

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ Python:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ FastAPI –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è redis
https://github.com/DVDemon/architecture_python/tree/main/07_redis

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã

```bash
docker-compose up --build
```

## üìä –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
`/api/v1/user/get_all` - —ç–Ω–¥–ø–æ–∏–Ω—Ç —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

#### üîÑ 1 –ø–æ—Ç–æ–∫ (–±–µ–∑ Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  1 threads and 1 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    67.56ms   66.07ms 532.26ms   94.09%
    Req/Sec    18.63      3.77    20.00     88.12%
  191 requests in 10.83s, 50.11KB read
Requests/sec:     17.64
Transfer/sec:      4.63KB
```

#### üîÑ 1 –ø–æ—Ç–æ–∫ (—Å Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  1 threads and 1 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    51.81ms    5.14ms  60.62ms   79.27%
    Req/Sec    19.29      2.56    20.00     93.00%
  193 requests in 10.01s, 50.63KB read
Requests/sec:     19.27
Transfer/sec:      5.06KB
```

#### üîÑ 5 –ø–æ—Ç–æ–∫–æ–≤ (–±–µ–∑ Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  5 threads and 5 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    62.41ms   10.48ms 129.55ms   67.12%
    Req/Sec    15.99      4.91    20.00     60.00%
  800 requests in 10.01s, 209.99KB read
Requests/sec:     79.90
Transfer/sec:     20.97KB
```

#### üîÑ 5 –ø–æ—Ç–æ–∫–æ–≤ (—Å Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  5 threads and 5 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    62.07ms   10.73ms  99.25ms   59.70%
    Req/Sec    16.06      4.89    20.00     60.80%
  804 requests in 10.02s, 211.04KB read
Requests/sec:     80.26
Transfer/sec:     21.07KB
```

#### üîÑ 10 –ø–æ—Ç–æ–∫–æ–≤ (–±–µ–∑ Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  10 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    88.57ms   79.79ms 565.57ms   93.25%
    Req/Sec    14.28      5.27    20.00     52.82%
  1460 requests in 10.90s, 382.72KB read
Requests/sec:    133.90
Transfer/sec:     35.10KB
```

#### üîÑ 10 –ø–æ—Ç–æ–∫–æ–≤ (—Å Redis)
```bash
Running 10s test @ http://localhost:8001/api/v1/user/get_all
  10 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   104.17ms  131.97ms   1.18s    92.42%
    Req/Sec    14.25      5.31    20.00     53.35%
  1445 requests in 11.14s, 379.17KB read
Requests/sec:    129.75
Transfer/sec:     34.05KB
```

## üíª –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### üñ•Ô∏è –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä:
- Intel Core i7-1065G7
- 4 —è–¥—Ä–∞, 8 –ø–æ—Ç–æ–∫–æ–≤ (Hyper-Threading)
- –ß–∞—Å—Ç–æ—Ç–∞: 1.30 GHz
- 8 GB –û–ó–£


### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: wrk
- –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç: `/api/v1/user/get_all`
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞: 10 —Å–µ–∫—É–Ω–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤: 1, 5, 10

#### üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. –¢–µ—Å—Ç —Å 1 –ø–æ—Ç–æ–∫–æ–º:
```bash
wrk -t1 -c1 -d10s http://localhost:8001/api/v1/user/get_all
```


2. –¢–µ—Å—Ç —Å 5 –ø–æ—Ç–æ–∫–∞–º–∏:
```bash
wrk -t5 -c5 -d10s http://localhost:8001/api/v1/user/get_all
```


3. –¢–µ—Å—Ç —Å 10 –ø–æ—Ç–æ–∫–∞–º–∏:
```bash
wrk -t10 -c10 -d10s http://localhost:8001/api/v1/user/get_all
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
1. –î–ª—è –¥–∞–Ω–Ω—ã—Ö, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–µ PotgreSQL —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —à–∞–±–ª–æ–Ω —Å–∫–≤–æ–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∏ —Å–∫–≤–æ–∑–Ω–∞—è –∑–∞–ø–∏—Å—å (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–ö–ª–∏–µ–Ω—Ç ‚Ä¶);
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–µ—Ä–≤–∏—Å–µ user_api_service:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (POST /api/v1/admin/create)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (GET /api/v1/user/{user_id})
- –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (GET /api/v1/user/get_all)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PUT /api/v1/user/{user_id})
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (DELETE /api/v1/user/{user_id})

2. –í –∫–∞—á–µ—Å—Ç–≤–µ –∫–µ—à–∞ ‚Äì –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Redis –≤ docker-compose.yaml:
```yaml
  redis:
    image: redis:latest
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 5s
      retries: 5
```

3. –ó–∞–º–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏ –±–µ–∑ –∫–µ—à–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç—ã wrk
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
—Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã—à–µ –≤ —Ä–∞–∑–¥–µ–ª–µ `–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏`

4. –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤ Structurizr DSL
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ


5. –í–∞—à–∏ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ docker-compose –∫–æ–º–∞–Ω–¥–æ–π docker-compose up
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ <br>

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
docker-compose up --build
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
‚úÖ –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Redis:
- lab5/user_api_service_with_redis/check_redis.py
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ
